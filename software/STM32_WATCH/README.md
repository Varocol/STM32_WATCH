# 模块列表

- [蜂鸣器](#蜂鸣器)

- [调试串口](#调试串口)

- [工作LED](#工作LED)

- [延时](#延时)

- [按键](#按键)

## 蜂鸣器

引脚：PA1

实现：

- 通道TIM2_CH2，pwm输出，dma连续装载，TIM1计时。TIM1的分频改为0.5ms为单位，这样不容易溢出。（考虑到dma装载以更新时间（即一次波形）为单位，所以需要使用中断累计延时总长度）。

提供数据：
- 蜂鸣器音量

功能：

- 选择提示

- 音乐

关联变量：

- beep_volume

由于使用的是TIM2，没有重复计数功能，下一代硬件会更改引脚，并使用重复计数+DMA

方案：
- systick基础延时+pwm输出（程序阻塞）
- tim定时器中断计时（计音符长度）+pwm输出（有更多时间处理动画）（目前采用的方案）
- 直接pwm输出DMA（会消耗非常大的空间，可以DMA中断片段装载）
- 高级定时器重复计数+DMA（最优方案）


## 调试串口

引脚：RX PA10 TX PA9

实现：

- 驱动USART1

功能：

-  输出调试日志


## 工作LED

引脚：PB9

实现方式：

- GPIO驱动

功能：

- 指示工作状态

- 指示充电状态

- 指示联网状态	

## 延时

实现方式：Systick

功能：

- 做基础延时

## 按键

KEY1 引脚：PA6

KEY2 引脚：PA4

KEY3 引脚：PA5

KEY4 引脚：PC13

实现方式：

- GPIO驱动

- TIM2定时器中断1ms轮询 

状态数据：

- 按键当前状态（不持续的，1ms宽度离散状态）

- 按键状态持续时间（以1ms为单位，1ms宽度离散状态）


功能：

- KEY4作为开关机按键，菜单确认按键

- KEY1 KEY2 KEY3 作为菜单功能选择按键或菜单确认按键
